# Simulation Configuration
# Defines all parameters for a genealogical simulation run

# Random seed for reproducibility
# Same seed + same config = identical results
seed: 42

# Output mode: 'quiet' (no output), 'monitor' (progress updates), or 'debug' (detailed debugging)
mode: quiet

# Number of years to simulate (cycles will be calculated from this)
years: 10

# Initial population size
initial_population_size: 1000

# Initial population sex ratio (males:females)
# Values are normalized to sum to 1.0
initial_sex_ratio:
  male: 0.5
  female: 0.5

# Creature archetype configuration
creature_archetype:
  # Breeding age limits (separate for males and females)
  max_breeding_age:
    male: 10
    female: 8
  
  # Maximum litters for females (litters_remaining starts at this value)
  max_litters: 5
  
  # Litter size range (number of offspring per breeding pair)
  # Each breeding pair produces a random number of offspring sampled from this range
  litter_size:
    min: 3
    max: 6
  
  # Lifespan range (separate from breeding age limits)
  # Each creature gets a random lifespan sampled from this range at birth
  # Creatures age out when age >= their individual lifespan
  lifespan:
    min: 12
    max: 18
  
  # Whether to remove creatures immediately when they can't reproduce
  # If true: remove when breeding age exceeded or litters_remaining <= 0
  # If false: persist until they age out (lifespan)
  remove_ineligible_immediately: false

# Target phenotypes for phenotype-selecting breeders
# Used by both kennel_club and mill breeders
target_phenotypes:
  - trait_id: 0
    phenotype: "Black"
  - trait_id: 1
    phenotype: "Large"

# Undesirable phenotypes and genotypes (breeders can be configured to avoid these)
# When avoid_undesirable_phenotypes or avoid_undesirable_genotypes is enabled,
# breeders will not select parents with these attributes
undesirable_phenotypes:
  # Example: Avoid creatures with brown coat color
  # - trait_id: 0
  #   phenotype: "Brown"
  
undesirable_genotypes:
  # Example: Avoid creatures with bb genotype
  # - trait_id: 0
  #   genotype: "bb"

# Breeder configuration
# Breeders are entities that own creatures and select mating pairs
# Each creature is owned by exactly one breeder at any given time
# 
# Ownership Rules:
# - Founders are assigned to breeders evenly at initialization
# - Offspring inherit ownership from the female parent's breeder
# - Transfers occur AFTER offspring are determined, only once per cycle
# - No transfer until creature has produced offspring
# - No transfer if creature is gestating or nursing
# - Kennel clubs: transfer males regularly, females ~3x in lifetime; won't accept mill-origin creatures
# - Mills: low transfer probability; may replace breeding females with offspring
# - Transfer restrictions ensure realistic breeding program dynamics
# 
# Capacity Limits:
# - Each breeder has a maximum number of creatures they can own (default: 7)
# - When offspring are born and breeder is at capacity, they are:
#   1. Kept as replacements if needed (parent died/aged out)
#   2. Transferred to another breeder with available capacity
#   3. Homed (marked is_homed=True) only if all breeders are at capacity
# - Capacity check occurs during offspring assignment, not via culling
breeders:
  # Number of breeders of each type (actual counts, not percentages)
  # Each breeder is assigned an ID and persists to the database
  random: 50
  inbreeding_avoidance: 30
  kennel_club: 15
  mill: 5
  
  # Maximum creatures per breeder (capacity limit)
  max_creatures: 7  # Default: 7; oldest creatures culled when exceeded
  
  # Kennel club breeder configuration (if using kennel_club breeder)
  kennel_club_config:
    # Guidelines/rules (target_phenotypes come from top-level config)
    max_inbreeding_coefficient: 0.125  # Avoid close relatives
    required_phenotype_ranges:
      - trait_id: 2
        min: "60.0"
        max: "80.0"
  
  # Configuration for avoiding undesirable traits
  # If true, ALL breeders will filter out creatures with undesirable phenotypes/genotypes
  avoid_undesirable_phenotypes: false  # If true, all breeders avoid undesirable phenotypes
  avoid_undesirable_genotypes: false   # If true, all breeders avoid undesirable genotypes
  
  # Ownership transfer configuration
  kennel_female_transfer_count: 3      # Number of times kennel females are transferred in lifetime (default: 3)
  mill_transfer_probability: 0.02      # Low probability for mill transfers per cycle (default: 0.02, vs 0.12 baseline)

# Trait definitions
traits:
  - trait_id: 0
    name: "Coat Color"
    trait_type: SIMPLE_MENDELIAN
    genotypes:
      - genotype: "BB"
        phenotype: "Black"
        initial_freq: 0.36
      - genotype: "Bb"
        phenotype: "Black"
        initial_freq: 0.48
      - genotype: "bb"
        phenotype: "Brown"
        initial_freq: 0.16
  
  - trait_id: 1
    name: "Body Size"
    trait_type: SIMPLE_MENDELIAN
    genotypes:
      - genotype: "LL"
        phenotype: "Large"
        initial_freq: 0.25
      - genotype: "Ll"
        phenotype: "Large"
        initial_freq: 0.50
      - genotype: "ll"
        phenotype: "Small"
        initial_freq: 0.25
  
  - trait_id: 2
    name: "Height"
    trait_type: POLYGENIC
    genotypes:
      - genotype: "H1H1_H2H2_H3H3"
        phenotype: "80.0"
        initial_freq: 0.027
      - genotype: "H1H1_H2H2_H3h3"
        phenotype: "75.0"
        initial_freq: 0.054
      - genotype: "H1H1_H2H2_h3h3"
        phenotype: "70.0"
        initial_freq: 0.027
      # ... additional genotype combinations
      - genotype: "h1h1_h2h2_h3h3"
        phenotype: "50.0"
        initial_freq: 0.027
  
  - trait_id: 3
    name: "Color Blindness"
    trait_type: SEX_LINKED
    genotypes:
      - genotype: "NN"
        phenotype: "Normal vision"
        sex: "female"
        initial_freq: 0.40
      - genotype: "Nc"
        phenotype: "Normal vision (carrier)"
        sex: "female"
        initial_freq: 0.10
      - genotype: "cc"
        phenotype: "Colorblind"
        sex: "female"
        initial_freq: 0.0025
      - genotype: "N"
        phenotype: "Normal vision"
        sex: "male"
        initial_freq: 0.47
      - genotype: "c"
        phenotype: "Colorblind"
        sex: "male"
        initial_freq: 0.0075

